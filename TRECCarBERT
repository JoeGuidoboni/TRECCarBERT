{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"TRECCarBERT","provenance":[],"collapsed_sections":[],"mount_file_id":"1pTxgkqZ17lkhP6xY-jBF3xaW__FqVMG2","authorship_tag":"ABX9TyPBj8KlqQb+iVYcCTohvymL"},"kernelspec":{"name":"python3","display_name":"Python 3"},"widgets":{"application/vnd.jupyter.widget-state+json":{"5f9b903894a442d3aa372f4796252c2e":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_4a50576b93f14cfeaae4b383447ae3e8","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_dbe08ab17a794fe39a2ec106aac38e50","IPY_MODEL_2fd97e788f5f48d484cd0dbe608279b8"]}},"4a50576b93f14cfeaae4b383447ae3e8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"dbe08ab17a794fe39a2ec106aac38e50":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_922bd3bf493c4ab7858b2b073d772364","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":433,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":433,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_51f183b4d04e49158a6a86acd8babbd6"}},"2fd97e788f5f48d484cd0dbe608279b8":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_54fa6da02116496fb61b4e90c454be6a","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 433/433 [02:14&lt;00:00, 3.23B/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_e594660075a541e590a51687fc02172a"}},"922bd3bf493c4ab7858b2b073d772364":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"51f183b4d04e49158a6a86acd8babbd6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"54fa6da02116496fb61b4e90c454be6a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"e594660075a541e590a51687fc02172a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"fc82aecfa4d64614a0c861b1cc27cf0d":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_d5446bded9ef49cba0dd2769f9829768","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_01f19e03df464722a1d84be77517a1de","IPY_MODEL_f498c1a368164d3db89a839f08a7967d"]}},"d5446bded9ef49cba0dd2769f9829768":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"01f19e03df464722a1d84be77517a1de":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_2bcbed6771b54afe8dff2cf89ff1fed5","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":440473133,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":440473133,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_4feb9eb9ff9b46b1bcb0b05a8fe8c346"}},"f498c1a368164d3db89a839f08a7967d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_ea4bc753c52f4cbab4d7a7a49de30240","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 440M/440M [00:17&lt;00:00, 25.9MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_1906c161c7034da38de7c68b76f0e908"}},"2bcbed6771b54afe8dff2cf89ff1fed5":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"4feb9eb9ff9b46b1bcb0b05a8fe8c346":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"ea4bc753c52f4cbab4d7a7a49de30240":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"1906c161c7034da38de7c68b76f0e908":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"733dc67ae7024298a2a098fd37dc63bf":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_979e7608ee9142949551be6e17ec9fa2","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_0b612856418748709f4df1ef955bd583","IPY_MODEL_9d8d8bee0c2f4aba8316c9b584009e7f"]}},"979e7608ee9142949551be6e17ec9fa2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"0b612856418748709f4df1ef955bd583":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_2bd63b7f94134265bfaf496c47add677","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":231508,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":231508,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_6717986fe97542159e7beaee97a036b2"}},"9d8d8bee0c2f4aba8316c9b584009e7f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_53016978b4f545aea77b8ce3cc261f16","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 232k/232k [00:03&lt;00:00, 59.2kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_4034d4f5a2234c2fa8f85089be103c0f"}},"2bd63b7f94134265bfaf496c47add677":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"6717986fe97542159e7beaee97a036b2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"53016978b4f545aea77b8ce3cc261f16":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"4034d4f5a2234c2fa8f85089be103c0f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"87e5542f806e4e9ba8f514af66bee61d":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_4ccdddef46844e149340cf1741fca91e","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_29c067e217734fb39ba47ba35868de19","IPY_MODEL_10869fbe76c74e5699735f5d1c827d3e"]}},"4ccdddef46844e149340cf1741fca91e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"29c067e217734fb39ba47ba35868de19":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_fb3f99cc30a74255a9d14427a59df373","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":28,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":28,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_4464ee1e21a7425f8d3948c71401d72f"}},"10869fbe76c74e5699735f5d1c827d3e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_f8736cc804894f6ca0ea565958279d80","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 28.0/28.0 [00:00&lt;00:00, 29.0B/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_6421dd06d3ee4c74b86a035f8961e4ef"}},"fb3f99cc30a74255a9d14427a59df373":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"4464ee1e21a7425f8d3948c71401d72f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"f8736cc804894f6ca0ea565958279d80":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"6421dd06d3ee4c74b86a035f8961e4ef":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"fcef07b069f84a7abdf8acb86202d203":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_d08147931e9249d0bd9ff1a78d7bdfb6","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_3135dfa2fb534df8b3c4b64f60890c02","IPY_MODEL_d82535ebe8524a8183555fb9ecbb05c6"]}},"d08147931e9249d0bd9ff1a78d7bdfb6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"3135dfa2fb534df8b3c4b64f60890c02":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_47064a975f4e4bfaabfbe56e4324afe1","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":466062,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":466062,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_cafee01e22244242916ca7d036b53024"}},"d82535ebe8524a8183555fb9ecbb05c6":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_a423c82d7d3145edb654cb9f6e371b91","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 466k/466k [00:00&lt;00:00, 481kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_a552537d97674d20910e72e63ed74928"}},"47064a975f4e4bfaabfbe56e4324afe1":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"cafee01e22244242916ca7d036b53024":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a423c82d7d3145edb654cb9f6e371b91":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"a552537d97674d20910e72e63ed74928":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":962,"referenced_widgets":["5f9b903894a442d3aa372f4796252c2e","4a50576b93f14cfeaae4b383447ae3e8","dbe08ab17a794fe39a2ec106aac38e50","2fd97e788f5f48d484cd0dbe608279b8","922bd3bf493c4ab7858b2b073d772364","51f183b4d04e49158a6a86acd8babbd6","54fa6da02116496fb61b4e90c454be6a","e594660075a541e590a51687fc02172a","fc82aecfa4d64614a0c861b1cc27cf0d","d5446bded9ef49cba0dd2769f9829768","01f19e03df464722a1d84be77517a1de","f498c1a368164d3db89a839f08a7967d","2bcbed6771b54afe8dff2cf89ff1fed5","4feb9eb9ff9b46b1bcb0b05a8fe8c346","ea4bc753c52f4cbab4d7a7a49de30240","1906c161c7034da38de7c68b76f0e908","733dc67ae7024298a2a098fd37dc63bf","979e7608ee9142949551be6e17ec9fa2","0b612856418748709f4df1ef955bd583","9d8d8bee0c2f4aba8316c9b584009e7f","2bd63b7f94134265bfaf496c47add677","6717986fe97542159e7beaee97a036b2","53016978b4f545aea77b8ce3cc261f16","4034d4f5a2234c2fa8f85089be103c0f","87e5542f806e4e9ba8f514af66bee61d","4ccdddef46844e149340cf1741fca91e","29c067e217734fb39ba47ba35868de19","10869fbe76c74e5699735f5d1c827d3e","fb3f99cc30a74255a9d14427a59df373","4464ee1e21a7425f8d3948c71401d72f","f8736cc804894f6ca0ea565958279d80","6421dd06d3ee4c74b86a035f8961e4ef","fcef07b069f84a7abdf8acb86202d203","d08147931e9249d0bd9ff1a78d7bdfb6","3135dfa2fb534df8b3c4b64f60890c02","d82535ebe8524a8183555fb9ecbb05c6","47064a975f4e4bfaabfbe56e4324afe1","cafee01e22244242916ca7d036b53024","a423c82d7d3145edb654cb9f6e371b91","a552537d97674d20910e72e63ed74928"]},"id":"TWjMns9D_k9V","executionInfo":{"status":"ok","timestamp":1619095677476,"user_tz":240,"elapsed":42237,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}},"outputId":"582e44c1-93bc-4d5a-a457-871386533ff3"},"source":["! pip install trec-car-tools transformers\n","import torch\n","from torch.nn import functional, CosineEmbeddingLoss, BCEWithLogitsLoss, CosineSimilarity, BCELoss\n","from torch.utils.data.dataset import Dataset\n","from trec_car import read_data\n","from cbor import *\n","from transformers import BertModel, BertTokenizer, BertForNextSentencePrediction, Trainer, TrainingArguments\n","import random\n","model = BertModel.from_pretrained('bert-base-uncased')\n","nspmodel = BertForNextSentencePrediction.from_pretrained('bert-base-uncased') #output_hidden_states=True\n","tokenizer = BertTokenizer.from_pretrained('bert-base-uncased')\n","file = 'train.pages.cbor'"],"execution_count":2,"outputs":[{"output_type":"stream","text":["Collecting trec-car-tools\n","  Downloading https://files.pythonhosted.org/packages/d1/e2/da4e895e5ad519f9f6aa464530dd482c7132c92a55cf178b8132e84b5c1d/trec_car_tools-2.5.4-py3-none-any.whl\n","Collecting transformers\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/d8/b2/57495b5309f09fa501866e225c84532d1fd89536ea62406b2181933fb418/transformers-4.5.1-py3-none-any.whl (2.1MB)\n","\u001b[K     |████████████████████████████████| 2.1MB 5.1MB/s \n","\u001b[?25hCollecting cbor>=1.0.0\n","  Downloading https://files.pythonhosted.org/packages/9b/99/01c6a987c920500189eb74a291bd3a388e6c7cf85736bb6b066d9833315e/cbor-1.0.0.tar.gz\n","Requirement already satisfied: numpy>=1.11.2 in /usr/local/lib/python3.7/dist-packages (from trec-car-tools) (1.19.5)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.7/dist-packages (from transformers) (4.41.1)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.7/dist-packages (from transformers) (2019.12.20)\n","Collecting sacremoses\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/75/ee/67241dc87f266093c533a2d4d3d69438e57d7a90abb216fa076e7d475d4a/sacremoses-0.0.45-py3-none-any.whl (895kB)\n","\u001b[K     |████████████████████████████████| 901kB 17.5MB/s \n","\u001b[?25hRequirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from transformers) (20.9)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.7/dist-packages (from transformers) (3.0.12)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from transformers) (2.23.0)\n","Requirement already satisfied: importlib-metadata; python_version < \"3.8\" in /usr/local/lib/python3.7/dist-packages (from transformers) (3.10.1)\n","Collecting tokenizers<0.11,>=0.10.1\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/ae/04/5b870f26a858552025a62f1649c20d29d2672c02ff3c3fb4c688ca46467a/tokenizers-0.10.2-cp37-cp37m-manylinux2010_x86_64.whl (3.3MB)\n","\u001b[K     |████████████████████████████████| 3.3MB 24.9MB/s \n","\u001b[?25hRequirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (7.1.2)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (1.0.1)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (1.15.0)\n","Requirement already satisfied: pyparsing>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->transformers) (2.4.7)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (2020.12.5)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (3.0.4)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata; python_version < \"3.8\"->transformers) (3.4.1)\n","Requirement already satisfied: typing-extensions>=3.6.4; python_version < \"3.8\" in /usr/local/lib/python3.7/dist-packages (from importlib-metadata; python_version < \"3.8\"->transformers) (3.7.4.3)\n","Building wheels for collected packages: cbor\n","  Building wheel for cbor (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for cbor: filename=cbor-1.0.0-cp37-cp37m-linux_x86_64.whl size=51257 sha256=db7d62d2ed208d882b45436a8830347e9bd97bc5976d58c33f020c4f26cec736\n","  Stored in directory: /root/.cache/pip/wheels/40/5c/a5/e6d629446a6a687ba328c55f1589234c29b99ef35b1a65dbaa\n","Successfully built cbor\n","Installing collected packages: cbor, trec-car-tools, sacremoses, tokenizers, transformers\n","Successfully installed cbor-1.0.0 sacremoses-0.0.45 tokenizers-0.10.2 transformers-4.5.1 trec-car-tools-2.5.4\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"5f9b903894a442d3aa372f4796252c2e","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=433.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"fc82aecfa4d64614a0c861b1cc27cf0d","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=440473133.0, style=ProgressStyle(descri…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"stream","text":["Some weights of the model checkpoint at bert-base-uncased were not used when initializing BertForNextSentencePrediction: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.decoder.weight', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias']\n","- This IS expected if you are initializing BertForNextSentencePrediction from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertForNextSentencePrediction from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"],"name":"stderr"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"733dc67ae7024298a2a098fd37dc63bf","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=231508.0, style=ProgressStyle(descripti…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"87e5542f806e4e9ba8f514af66bee61d","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=28.0, style=ProgressStyle(description_w…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"fcef07b069f84a7abdf8acb86202d203","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=466062.0, style=ProgressStyle(descripti…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"lpky9zf79uKq","executionInfo":{"status":"ok","timestamp":1619095767588,"user_tz":240,"elapsed":481,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}}},"source":["def generate_wrong_next(corpus):\n","  # helper function\n","  # given an array of paragraphs, generate wrong next paras\n","  # cant do completely random as there is a random chance to pick next para using shuffle()\n","  # which i want to avoid\n","  wrong_next = []\n","  second_sentences = corpus[1:len(corpus)]\n","  for i in range(len(second_sentences)):\n","    temp = second_sentences.copy()\n","    temp.pop(i)\n","    next = random.choice(temp)\n","    wrong_next.append(next)\n","  return wrong_next"],"execution_count":3,"outputs":[]},{"cell_type":"code","metadata":{"id":"j4E90YX4BspI","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1619023267728,"user_tz":240,"elapsed":37671,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}},"outputId":"8c371ced-1c7c-4d93-e776-85ffc2e61188"},"source":["labels = []\n","first_input_ids = torch.empty(0)\n","second_input_ids = torch.empty(0)\n","pages = read_data.iter_pages(open(file, 'rb'))\n","count = 0\n","pagecount = 0\n","for page in pages:\n","      pagecount += 1\n","      corpus = page.get_text().split('\\n')\n","      count += len(corpus)\n","\n","      first_sentences = corpus[0:len(corpus) - 1]\n","      second_sentences = corpus[1:len(corpus)]\n","      wrong_next_sentences = generate_wrong_next(corpus)\n","\n","      first_encoding = tokenizer(first_sentences, return_tensors='pt', padding='max_length', max_length=256, truncation=True)\n","      second_encoding = tokenizer(second_sentences, return_tensors='pt', padding='max_length', max_length=256, truncation=True)\n","      wrong_encoding = tokenizer(wrong_next_sentences, return_tensors='pt', padding='max_length', max_length=256, truncation=True)\n","\n","      p_labels = [1.] * first_encoding['input_ids'].size()[0]\n","      n_labels = [-1.] * first_encoding['input_ids'].size()[0]\n","      labels += p_labels + n_labels\n","\n","      # good = torch.tensor(first_encoding, second_encoding)\n","      # bad = torch.tensor(first_encoding, wrong_encoding)\n","\n","      p_encodings = torch.cat((first_encoding['input_ids'], first_encoding['input_ids']), 0)\n","      n_encodings = torch.cat((second_encoding['input_ids'], wrong_encoding['input_ids']), 0)\n","\n","\n","      # encoding_cat = torch.cat((p_encoding['input_ids'], n_encoding['input_ids']), 0)\n","      first_input_ids = torch.cat((p_encodings, first_input_ids), 0)\n","      second_input_ids = torch.cat((n_encodings, second_input_ids), 0)\n","\n","print(first_input_ids.size())\n","print(second_input_ids.size())\n","print(len(labels))\n","print(count) # number of paragraphs\n","print(pagecount)"],"execution_count":7,"outputs":[{"output_type":"stream","text":["torch.Size([11858, 256])\n","torch.Size([11858, 256])\n","11858\n","6046\n","117\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"wrS2GzSW4zXQ","executionInfo":{"status":"ok","timestamp":1619024878898,"user_tz":240,"elapsed":4623,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}},"outputId":"44452dba-a386-456e-9294-2b34fa9702a4"},"source":["index = 40\n","# print(first_input_ids[index].type(torch.LongTensor))\n","# print(second_input_ids[index])\n","print(labels[index])\n","first_logits = model(first_input_ids[40:42].type(torch.LongTensor))[0]\n","second_logits = model(second_input_ids[40:42].type(torch.LongTensor))[0]\n","\n","first_logits = torch.mean(first_logits, 2)\n","second_logits = torch.mean(second_logits, 2)\n","\n","print(first_logits.size())\n","print(second_logits.size())\n","\n","cos = CosineSimilarity()\n","c1 = cos(first_logits, second_logits)\n","\n","loss = BCEWithLogitsLoss(reduction='none')\n","\n"],"execution_count":10,"outputs":[{"output_type":"stream","text":["1.0\n","torch.Size([2, 256])\n","torch.Size([2, 256])\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"ijJ29cy0Eny4","executionInfo":{"status":"ok","timestamp":1619095773843,"user_tz":240,"elapsed":696,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}}},"source":["class BaseBertDataSet(Dataset):\n","  \"\"\"\n","  Generates a dataset of pairs of paragraphs.\n","  [paragraph, following paragraph]\n","\n","  \"\"\"\n","  def __init__(self, file):\n","    self.file = file\n","    self.labels = []\n","    self.first_input_ids = torch.empty(0)\n","    self.second_input_ids = torch.empty(0)\n","\n","    pages = read_data.iter_pages(open(file, 'rb'))\n","    for page in pages:\n","      corpus = page.get_text().split('\\n')\n","\n","      first_sentences = corpus[0:len(corpus) - 1]\n","      second_sentences = corpus[1:len(corpus)]\n","      wrong_next_sentences = generate_wrong_next(corpus)\n","\n","      first_encoding = tokenizer(first_sentences, return_tensors='pt', padding='max_length', max_length=128, truncation=True)\n","      second_encoding = tokenizer(second_sentences, return_tensors='pt', padding='max_length', max_length=128, truncation=True)\n","      wrong_encoding = tokenizer(wrong_next_sentences, return_tensors='pt', padding='max_length', max_length=128, truncation=True)\n","\n","      p_labels = [1.] * first_encoding['input_ids'].size()[0]\n","      n_labels = [-1.] * first_encoding['input_ids'].size()[0]\n","      self.labels += p_labels + n_labels\n","\n","      # good = torch.tensor(first_encoding, second_encoding)\n","      # bad = torch.tensor(first_encoding, wrong_encoding)\n","\n","      p_encodings = torch.cat((first_encoding['input_ids'], first_encoding['input_ids']), 0)\n","      n_encodings = torch.cat((second_encoding['input_ids'], wrong_encoding['input_ids']), 0)\n","\n","\n","      # encoding_cat = torch.cat((p_encoding['input_ids'], n_encoding['input_ids']), 0)\n","      self.first_input_ids = torch.cat((p_encodings, self.first_input_ids), 0)\n","      self.second_input_ids = torch.cat((n_encodings, self.second_input_ids), 0)\n","\n","    \n","  def __len__(self):\n","    return self.first_input_ids.size()[0]\n","\n","  def __getitem__(self, index):\n","    # label as 1 because we want the the cosine to be close to 1 for these following sentences\n","    sample = {'first_input_ids': self.first_input_ids[index].type(torch.LongTensor), 'second_input_ids':  self.second_input_ids[index].type(torch.LongTensor), 'label': self.labels[index]}\n","    return sample\n"],"execution_count":4,"outputs":[]},{"cell_type":"code","metadata":{"id":"LGl5Dm_RdC_L"},"source":["class BertFNSDataSet(Dataset):\n","  \"\"\"\n","  BertForNextSentence\n","  Generates a dataset of pairs of paragraphs.\n","  [paragraph, following paragraph]\n","\n","  \"\"\"\n","  def __init__(self, file):\n","    self.file = file\n","    self.labels = []\n","    self.input_ids = torch.empty(0)\n","\n","    pages = read_data.iter_pages(open(file, 'rb'))\n","    for page in pages:\n","      corpus = page.get_text().split('\\n')\n","\n","      first_sentences = corpus[0:len(corpus) - 1]\n","      second_sentences = corpus[1:len(corpus)]\n","      wrong_next_sentences = generate_wrong_next(corpus)\n","\n","      p_encoding = tokenizer(first_sentences, second_sentences, return_tensors='pt', padding='max_length', max_length=512, truncation=True)\n","      p_labels = [1] * p_encoding['input_ids'].size()[0]\n","      n_encoding = tokenizer(first_sentences, wrong_next_sentences, return_tensors='pt', padding='max_length', max_length=512, truncation=True)\n","      n_labels = [0] * n_encoding['input_ids'].size()[0]\n","      self.labels += p_labels + n_labels\n","      encoding_cat = torch.cat((p_encoding['input_ids'], n_encoding['input_ids']), 0)\n","      self.input_ids = torch.cat((encoding_cat, self.input_ids), 0)\n","\n","    \n","  def __len__(self):\n","    return self.input_ids.size()[0]\n","\n","  def __getitem__(self, index):\n","    sample = {'input_ids': self.input_ids[index].type(torch.LongTensor), 'label': self.labels[index]}\n","    return sample\n"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"2jDPxxNXB_YW","executionInfo":{"status":"ok","timestamp":1619024906162,"user_tz":240,"elapsed":180,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}}},"source":["class CosineSimTrainer(Trainer):\n","  def compute_loss(self, model, inputs, return_outputs=False):\n","    labels = inputs.pop('labels')\n","    first_sentences = inputs['first_input_ids']\n","    second_sentences = inputs['second_input_ids']\n","    first_logits = model(first_sentences)[0]\n","    second_logits = model(second_sentences)[0]\n","\n","    # taking the mean of the last layer\n","    first_logits = torch.mean(first_logits, 2) \n","    second_logits = torch.mean(second_logits, 2) \n","    # outputs = torch.cat((first_logits, second_logits), 0)\n","    outputs = {\n","        \"first_logits\": first_logits,\n","        \"second_logits\": second_logits\n","    }\n","    cos = CosineSimilarity()\n","    c = cos(first_logits, second_logits)\n","\n","    lf = BCEWithLogitsLoss()\n","    loss = lf(c, labels)\n","    \n","    # sim = cos(first_logits, second_logits)\n","    return (loss, outputs) if return_outputs else loss\n","\n"],"execution_count":11,"outputs":[]},{"cell_type":"code","metadata":{"id":"boPZDPwKPGrz","executionInfo":{"status":"ok","timestamp":1619095779727,"user_tz":240,"elapsed":573,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}}},"source":["class CosineEmbTrainer(Trainer):\n","  def compute_loss(self, model, inputs, return_outputs=False):\n","    labels = inputs.pop('labels')\n","    first_sentences = inputs['first_input_ids']\n","    second_sentences = inputs['second_input_ids']\n","    first_logits = model(first_sentences)[0]\n","    second_logits = model(second_sentences)[0]\n","\n","    # taking the mean of the last layer\n","    first_logits = torch.mean(first_logits, 2) \n","    second_logits = torch.mean(second_logits, 2) \n","    # outputs = torch.cat((first_logits, second_logits), 0)\n","    outputs = {\n","        \"first_logits\": first_logits,\n","        \"second_logits\": second_logits\n","    }\n","    cos = CosineEmbeddingLoss()\n","    loss = cos(first_logits, second_logits, labels)\n","    \n","    # sim = cos(first_logits, second_logits)\n","    return (loss, outputs) if return_outputs else loss"],"execution_count":5,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"KrNFqGgCoB5W","executionInfo":{"status":"ok","timestamp":1619095818727,"user_tz":240,"elapsed":37090,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}},"outputId":"16a1f2e6-d899-4032-b246-2d1ac813aac7"},"source":["ds = BaseBertDataSet(file)\n","ds_len = ds.__len__()\n","print(ds_len)\n","train_len = int(round(0.8 * ds_len))\n","eval_len = int(round(0.2 * ds_len))\n","train_dataset, eval_dataset = torch.utils.data.random_split(ds, [train_len, eval_len])\n","print(train_len)"],"execution_count":6,"outputs":[{"output_type":"stream","text":["11858\n","9486\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"gR9DivE0J9Yq","executionInfo":{"status":"ok","timestamp":1619095824648,"user_tz":240,"elapsed":1376,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}}},"source":["training_args = TrainingArguments(\n","    output_dir='./drive/MyDrive/thesis_models/bert/cosine_emb_bY1_batch16',          # output directory\n","    num_train_epochs=2,              # total # of training epochs\n","    per_device_train_batch_size=16,  # batch size per device during training\n","    per_device_eval_batch_size=64,   # batch size for evaluation\n","    warmup_steps=500,                # number of warmup steps for learning rate scheduler\n","    weight_decay=0.01,               # strength of weight decay\n","    logging_dir='./logs',            # directory for storing logs\n","    save_strategy='epoch'\n",")\n","\n","\n","\n","trainer = CosineEmbTrainer(\n","    model=model,                         # the instantiated 🤗 Transformers model to be trained\n","    args=training_args,                  # training arguments, defined above\n","    train_dataset = train_dataset,\n","    eval_dataset = eval_dataset\n",")\n"],"execution_count":7,"outputs":[]},{"cell_type":"code","metadata":{"id":"HeJdYzJIc7iL","colab":{"base_uri":"https://localhost:8080/","height":75},"outputId":"3e571c54-695e-4080-c883-06bf5b5c872f"},"source":["trainer.train()"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='381' max='1186' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [ 381/1186 7:04:13 < 15:01:03, 0.01 it/s, Epoch 0.64/2]\n","    </div>\n","    <table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>Step</th>\n","      <th>Training Loss</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","  </tbody>\n","</table><p>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}}]},{"cell_type":"code","metadata":{"id":"SumOs5S6Nr6R"},"source":["model.from_pretrained('./drive/MyDrive/thesis_models/bert/cosine-EMB/checkpoint-988')"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"ecEGFcN5Eiss","colab":{"base_uri":"https://localhost:8080/","height":156},"executionInfo":{"status":"ok","timestamp":1618611322087,"user_tz":240,"elapsed":3890824,"user":{"displayName":"Joe Guidoboni","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14GicjELKWn11LAqT4-JbAvs2J_9ui3lgqZTFM9Jclw=s64","userId":"10434009246200619867"}},"outputId":"46812e5e-dc26-46cb-c71c-7a4e850bc0fc"},"source":["trainer.evaluate()\n","# model.save_pretrained('./drive/MyDrive/thesis_models/bert')\n","# nspmodel.save_pretrained('./drive/MyDrive/thesis_models/bertfnsp')"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","        </style>\n","      \n","      <progress value='44' max='44' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      [44/44 1:03:20]\n","    </div>\n","    "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"execute_result","data":{"text/plain":["{'eval_loss': 0.016463909298181534,\n"," 'eval_mem_cpu_alloc_delta': 45899776,\n"," 'eval_mem_cpu_peaked_delta': 55988224,\n"," 'eval_runtime': 3889.5014,\n"," 'eval_samples_per_second': 0.714,\n"," 'init_mem_cpu_alloc_delta': 0,\n"," 'init_mem_cpu_peaked_delta': 0}"]},"metadata":{"tags":[]},"execution_count":9}]},{"cell_type":"code","metadata":{"id":"Xv6DBKqrWXZo"},"source":[""],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"fI3QptBdefpa"},"source":[""],"execution_count":null,"outputs":[]}]}